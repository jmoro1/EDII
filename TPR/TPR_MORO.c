#define SRAM_SIZE		((uint32_t) 0x00005000)
#define SRAM_BASE		((uint32_t) 0x20000000)
#define STACKINIT		((interrupt_t)(SRAM_BASE+SRAM_SIZE))

#include <math.h>
#define PI 3.14159265
#define SAMPLES 1024  // CAMBIO DE 512 A 1024 MUESTRAS

typedef int			   int32_t;
typedef short		   int16_t;
typedef char		   int8_t;
typedef unsigned int   uint32_t;
typedef unsigned short uint16_t;
typedef unsigned char  uint8_t;

typedef void(*interrupt_t)(void);

int  main(void);

const interrupt_t vector_table[SAMPLES] __attribute__ ((section(".vtab"))) = {
	STACKINIT,												// 0x0000_0000 Stack Pointer
	(interrupt_t) main,										// 0x0000_0004 Reset
};

/*Vector data donde se guardan los ceros y unos de cada señal que se envía*/
uint32_t data[SAMPLES] = {};

/**SIGMA_DELTA**/  //(MODIFICAR PARA QUE FUNCIONE PARA UNA SOLA MUESTRA)
void sigma_delta(int * wavein, int mysamples, int cont){
	int i;
	int integrator = wavein[0];
	int waveout_aux[mysamples]; 
	
	for(i=0; i<mysamples; i++){
		if(i > 0) integrator += (wavein[i] - waveout_aux[i-1]);
		if(integrator > 0){
			waveout_aux[i] = 128*cont;                          //--CAMBIO A 128 PARA REPRESENTARLO EN 8 BITS (-128 A 127)
			data[i] = 0x00002000;								// Es un 1 en el pin 13 del ODR por donde saldrá la señal en la placa
		}
		else {
			waveout_aux[i] = -128*cont;                          //--CAMBIO A 128 PARA REPRESENTARLO EN 8 BITS (-128 A 127)
			data[i] = 0x00000000;								// Es un 0 en el pin 13 del ODR por donde saldrá la señal en la placa
		}
	}
}


/****VECTORES PARA LOS SENOS BASES*/
/**1KHZ SIN*/
const unsigned short SinTab1k[SAMPLES] = {    0,     0,     1,     2,     3,     3,     4,     5,     6,     7,     7,     8,     9,    10,    10,    11,    12,    13,    14,    14,    15,    16,    17,    18,    18,    19,    20,    21,    21,    22,    23,    24,    24,    25,    26,    27,    28,    28,    29,    30,    31,    31,    32,    33,    34,    34,    35,    36,    37,    37,    38,    39,    40,    40,    41,    42,    43,  
  43,    44,    45,    46,    46,    47,    48,    48,    49,    50,    51,    51,    52,    53,    54,    54,    55,    56,    56,    57,    58,    58,    59,    60,    61,    61,    62,    63,    63,    64,    65,    65,    66,    67,    67,    68,    69,    69,    70,    71,    71,    72,    73,    73,    74,    74,    75,    76,    76,    77,    78,    78,    79,    79,    80,    81,    81,    82,    83,    83,    84,    84,    85, 
   85,    86,    87,    87,    88,    88,    89,    89,    90,    91,    91,    92,    92,    93,    93,    94,    94,    95,    95,    96,    96,    97,    97,    98,    98,    99,    99,   100,   100,   101,   101,   102,   102,   103,   103,   104,   104,   105,   105,   105,   106,   106,   107,   107,   108,   108,   108,   109,   109,   110,   110,   110,   111,   111,   112,   112,   112,   113,   113,   113,   114,   114,   115,
      115,   115,   116,   116,   116,   117,   117,   117,   117,   118,   118,   118,   119,   119,   119,   119,   120,   120,   120,   121,   121,   121,   121,   122,   122,   122,   122,   122,   123,   123,   123,   
123,   123,   124,   124,   124,   124,   124,   125,   125,   125,   125,   125,   125,   125,   126,   126,   126,   126,   126,   126,   126,   126,   127,   127,   127,   127,   127,   127,   127,   127,   127,   127,   127,   127,   127,   127,   127,   127,   127,   127,   127,   127,   128,   127,   127,   127,   127,   127,   127,   127,   127,   127,   127,   127,   127,   127,   127,   127,   127,   127,   127,   127,   127,  
 126,   126,   126,   126,   126,   126,   126,   126,   125,   125,   125,   125,   125,   125,   125,   124,   124,   124,   124,   124,   123,   123,   123,   123,   123,   122,   122,   122,   122,   122,   121,   121,   121,   121,   120,   120,   120,   119,   119,   119,   119,   118,   118,   118,   117,   117,   117,   117,   116,   116,   116,   115,   115,   115,   114,   114,   113,   113,   113,   112,   112,   112,   111, 
  111,   110,   110,   110,   109,   109,   108,   108,   108,   107,   107,   106,   106,   105,   105,   105,   104,   104,   103,   103,   102,   102,   101,   101,   100,   100,    99,    99,    98,    98,    97,    
97,    96,    96,    95,    95,    94,    94,    93,    93,    92,    92,    91,    91,    90,    89,    89,    88,    88,    87,    87,    86,    85,    85,    84,    84,    83,    83,    82,    81,    81,    80,    79,    79,    78,    78,    77,    76,    76,    75,    74,    74,    73,    73,    72,    71,    71,    70,    69,    69,    68,    67,    67,    66,    65,    65,    64,    63,    63,    62,    61,    61,    60,    59,   
 58,    58,    57,    56,    56,    55,    54,    54,    53,    52,    51,    51,    50,    49,    48,    48,    47,    46,    46,    45,    44,    43,    43,    42,    41,    40,    40,    39,    38,    37,    37,    36,    35,    34,    34,    33,    32,    31,    31,    30,    29,    28,    28,    27,    26,    25,    24,    24,    23,    22,    21,    21,    20,    19,    18,    18,    17,    16,    15,    14,    14,    13,    12,  
  11,    10,    10,     9,     8,     7,     7,     6,     5,     4,     3,     3,     2,     1,     0,     0,     0,    -1,    -2,    -3,    -3,    -4,    -5,    -6,    -7,    -7,    -8,    -9,   -10,   -10,   -11,   -12,   -13,   -14,   -14,   -15,   -16,   -17,   -18,   -18,   -19,   -20,   -21,   -21,   -22,   -23,   -24,   -24,   -25,   -26,   -27,   -28,   -28,   -29,   -30,   -31,   -31,   -32,   -33,   -34,   -34,   -35,   -36, 
  -37,   -37,   -38,   -39,   -40,   -40,   -41,   -42,   -43,   -43,   -44,   -45,   -46,   -46,   -47,   -48,   -48,   -49,   -50,   -51,   -51,   -52,   -53,   -54,   -54,   -55,   -56,   -56,   -57,   -58,   -58,   -59,   -60,   -61,   -61,   -62,   -63,   -63,   -64,   -65,   -65,   -66,   -67,   -67,   -68,   -69,   -69,   -70,   -71,   -71,   -72,   -73,   -73,   -74,   -74,   -75,   -76,   -76,   -77,   -78,   -78,   -79,   -79,
     -80,   -81,   -81,   -82,   -83,   -83,   -84,   -84,   -85,   -85,   -86,   -87,   -87,   -88,   -88,   -89,   -89,   -90,   -91,   -91,   -92,   -92,   -93,   -93,   -94,   -94,   -95,   -95,   -96,   -96,   -97,   
-97,   -98,   -98,   -99,   -99,  -100,  -100,  -101,  -101,  -102,  -102,  -103,  -103,  -104,  -104,  -105,  -105,  -105,  -106,  -106,  -107,  -107,  -108,  -108,  -108,  -109,  -109,  -110,  -110,  -110,  -111,  -111,  -112,  -112,  -112,  -113,  -113,  -113,  -114,  -114,  -115,  -115,  -115,  -116,  -116,  -116,  -117,  -117,  -117,  -117,  -118,  -118,  -118,  -119,  -119,  -119,  -119,  -120,  -120,  -120,  -121,  -121,  -121,  
-121,  -122,  -122,  -122,  -122,  -122,  -123,  -123,  -123,  -123,  -123,  -124,  -124,  -124,  -124,  -124,  -125,  -125,  -125,  -125,  -125,  -125,  -125,  -126,  -126,  -126,  -126,  -126,  -126,  -126,  -126,  -127,  -127,  -127,  -127,  -127,  -127,  -127,  -127,  -127,  -127,  -127,  -127,  -127,  -127,  -127,  -127,  -127,  -127,  -127,  -127,  -128,  -127,  -127,  -127,  -127,  -127,  -127,  -127,  -127,  -127,  -127,  -127, 
 -127,  -127,  -127,  -127,  -127,  -127,  -127,  -127,  -127,  -126,  -126,  -126,  -126,  -126,  -126,  -126,  -126,  -125,  -125,  -125,  -125,  -125,  -125,  -125,  -124,  -124,  -124,  -124,  -124,  -123,  -123,  -123,  -123,  -123,  -122,  -122,  -122,  -122,  -122,  -121,  -121,  -121,  -121,  -120,  -120,  -120,  -119,  -119,  -119,  -119,  -118,  -118,  -118,  -117,  -117,  -117,  -117,  -116,  -116,  -116,  -115,  -115,  -115,
   -114,  -114,  -113,  -113,  -113,  -112,  -112,  -112,  -111,  -111,  -110,  -110,  -110,  -109,  -109,  -108,  -108,  -108,  -107,  -107,  -106,  -106,  -105,  -105,  -105,  -104,  -104,  -103,  -103,  -102,  -102,  -101,  -101,  -100,  -100,   -99,   -99,   -98,   -98,   -97,   -97,   -96,   -96,   -95,   -95,   -94,   -94,   -93,   -93,   -92,   -92,   -91,   -91,   -90,   -89,   -89,   -88,   -88,   -87,   -87,   -86,   -85,   -85,
      -84,   -84,   -83,   -83,   -82,   -81,   -81,   -80,   -79,   -79,   -78,   -78,   -77,   -76,   -76,   -75,   -74,   -74,   -73,   -73,   -72,   -71,   -71,   -70,   -69,   -69,   -68,   -67,   -67,   -66,   -65,  
 -65,   -64,   -63,   -63,   -62,   -61,   -61,   -60,   -59,   -58,   -58,   -57,   -56,   -56,   -55,   -54,   -54,   -53,   -52,   -51,   -51,   -50,   -49,   -48,   -48,   -47,   -46,   -46,   -45,   -44,   -43,   -43,   -42,   -41,   -40,   -40,   -39,   -38,   -37,   -37,   -36,   -35,   -34,   -34,   -33,   -32,   -31,   -31,   -30,   -29,   -28,   -28,   -27,   -26,   -25,   -24,   -24,   -23,   -22,   -21,   -21,   -20,   -19, 
  -18,   -18,   -17,   -16,   -15,   -14,   -14,   -13,   -12,   -11,   -10,   -10,    -9,    -8,    -7,    -7,    -6,    -5,    -4,    -3,    -3,    -2,    -1,     0};

/**2KHZ SIN*/
const unsigned short SinTab2k[SAMPLES] = {    0,     1,     3,     4,     6,     7,     9,    10,    12,    14,    15,    17,    18,    20,    21,    23,    24,    26,    28,    29,    31,    32,    34,    35,    37,   
 38,    40,    41,    43,    44,    46,    47,    48,    50,    51,    53,    54,    56,    57,    58,    60,    61,    63,    64,    65,    67,    68,    69,    71,    72,    73,    74,    76,    77,    78,    79,    81,    82,    83,    84,    85,    87,    88,    89,    90,    91,    92,    93,    94,    95,    96,    97,    98,    99,   100,   101,   102,   103,   104,   105,   106,   107,   108,   108,   109,   110,   111,   112,  
 112,   113,   114,   115,   115,   116,   117,   117,   118,   118,   119,   119,   120,   121,   121,   122,   122,   122,   123,   123,   124,   124,   124,   125,   125,   125,   126,   126,   126,   126,   127,   127,   127,   127,   127,   127,   127,   127,   127,   127,   128,   127,   127,   127,   127,   127,   127,   127,   127,   127,   127,   126,   126,   126,   126,   125,   125,   125,   124,   124,   124,   123,   123, 
  122,   122,   122,   121,   121,   120,   119,   119,   118,   118,   117,   117,   116,   115,   115,   114,   113,   112,   112,   111,   110,   109,   108,   108,   107,   106,   105,   104,   103,   102,   101,   100,    99,    98,    97,    96,    95,    94,    93,    92,    91,    90,    89,    88,    87,    85,    84,    83,    82,    81,    79,    78,    77,    76,    74,    73,    72,    71,    69,    68,    67,    65,    64,    63,    61,    60,    58,    57,    56,    54,    53,    51,    50,    48,    47,    46,    44,    43,    41,    40,    38,    37,    35,    34,    32,    31,    29,    28,    26,    24,    23,    21,    20,    18,   
 17,    15,    14,    12,    10,     9,     7,     6,     4,     3,     1,     0,    -1,    -3,    -4,    -6,    -7,    -9,   -10,   -12,   -14,   -15,   -17,   -18,   -20,   -21,   -23,   -24,   -26,   -28,   -29,   -31,   -32,   -34,   -35,   -37,   -38,   -40,   -41,   -43,   -44,   -46,   -47,   -48,   -50,   -51,   -53,   -54,   -56,   -57,   -58,   -60,   -61,   -63,   -64,   -65,   -67,   -68,   -69,   -71,   -72,   -73,   -74,  
 -76,   -77,   -78,   -79,   -81,   -82,   -83,   -84,   -85,   -87,   -88,   -89,   -90,   -91,   -92,   -93,   -94,   -95,   -96,   -97,   -98,   -99,  -100,  -101,  -102,  -103,  -104,  -105,  -106,  -107,  -108,  -108,  -109,  -110,  -111,  -112,  -112,  -113,  -114,  -115,  -115,  -116,  -117,  -117,  -118,  -118,  -119,  -119,  -120,  -121,  -121,  -122,  -122,  -122,  -123,  -123,  -124,  -124,  -124,  -125,  -125,  -125,  -126, 
 -126,  -126,  -126,  -127,  -127,  -127,  -127,  -127,  -127,  -127,  -127,  -127,  -127,  -128,  -127,  -127,  -127,  -127,  -127,  -127,  -127,  -127,  -127,  -127,  -126,  -126,  -126,  -126,  -125,  -125,  -125,  -124,  -124,  -124,  -123,  -123,  -122,  -122,  -122,  -121,  -121,  -120,  -119,  -119,  -118,  -118,  -117,  -117,  -116,  -115,  -115,  -114,  -113,  -112,  -112,  -111,  -110,  -109,  -108,  -108,  -107,  -106,  -105,  -104,  -103,  -102,  -101,  -100,   -99,   -98,   -97,   -96,   -95,   -94,   -93,   -92,   -91,   -90,   -89,   -88,   -87,   -85,   -84,   -83,   -82,   -81,   -79,   -78,   -77,   -76,   -74,   -73,   -72,   -71,   
-69,   -68,   -67,   -65,   -64,   -63,   -61,   -60,   -58,   -57,   -56,   -54,   -53,   -51,   -50,   -48,   -47,   -46,   -44,   -43,   -41,   -40,   -38,   -37,   -35,   -34,   -32,   -31,   -29,   -28,   -26,   -24,   -23,   -21,   -20,   -18,   -17,   -15,   -14,   -12,   -10,    -9,    -7,    -6,    -4,    -3,    -1,     0,     1,     3,     4,     6,     7,     9,    10,    12,    14,    15,    17,    18,    20,    21,    23,  
  24,    26,    28,    29,    31,    32,    34,    35,    37,    38,    40,    41,    43,    44,    46,    47,    48,    50,    51,    53,    54,    56,    57,    58,    60,    61,    63,    64,    65,    67,    68,    69,    71,    72,    73,    74,    76,    77,    78,    79,    81,    82,    83,    84,    85,    87,    88,    89,    90,    91,    92,    93,    94,    95,    96,    97,    98,    99,   100,   101,   102,   103,   104, 
  105,   106,   107,   108,   108,   109,   110,   111,   112,   112,   113,   114,   115,   115,   116,   117,   117,   118,   118,   119,   119,   120,   121,   121,   122,   122,   122,   123,   123,   124,   124,   124,   125,   125,   125,   126,   126,   126,   126,   127,   127,   127,   127,   127,   127,   127,   127,   127,   127,   128,   127,   127,   127,   127,   127,   127,   127,   127,   127,   127,   126,   126,   126,   126,   125,   125,   125,   124,   124,   124,   123,   123,   122,   122,   122,   121,   121,   120,   119,   119,   118,   118,   117,   117,   116,   115,   115,   114,   113,   112,   112,   111,   110,   109,   
108,   108,   107,   106,   105,   104,   103,   102,   101,   100,    99,    98,    97,    96,    95,    94,    93,    92,    91,    90,    89,    88,    87,    85,    84,    83,    82,    81,    79,    78,    77,    76,    74,    73,    72,    71,    69,    68,    67,    65,    64,    63,    61,    60,    58,    57,    56,    54,    53,    51,    50,    48,    47,    46,    44,    43,    41,    40,    38,    37,    35,    34,    32,  
  31,    29,    28,    26,    24,    23,    21,    20,    18,    17,    15,    14,    12,    10,     9,     7,     6,     4,     3,     1,     0,    -1,    -3,    -4,    -6,    -7,    -9,   -10,   -12,   -14,   -15,   -17,   -18,   -20,   -21,   -23,   -24,   -26,   -28,   -29,   -31,   -32,   -34,   -35,   -37,   -38,   -40,   -41,   -43,   -44,   -46,   -47,   -48,   -50,   -51,   -53,   -54,   -56,   -57,   -58,   -60,   -61,   -63, 
  -64,   -65,   -67,   -68,   -69,   -71,   -72,   -73,   -74,   -76,   -77,   -78,   -79,   -81,   -82,   -83,   -84,   -85,   -87,   -88,   -89,   -90,   -91,   -92,   -93,   -94,   -95,   -96,   -97,   -98,   -99,  -100,  -101,  -102,  -103,  -104,  -105,  -106,  -107,  -108,  -108,  -109,  -110,  -111,  -112,  -112,  -113,  -114,  -115,  -115,  -116,  -117,  -117,  -118,  -118,  -119,  -119,  -120,  -121,  -121,  -122,  -122,  -122,  -123,  -123,  -124,  -124,  -124,  -125,  -125,  -125,  -126,  -126,  -126,  -126,  -127,  -127,  -127,  -127,  -127,  -127,  -127,  -127,  -127,  -127,  -128,  -127,  -127,  -127,  -127,  -127,  -127,  -127,  -127,
    -127,  -127,  -126,  -126,  -126,  -126,  -125,  -125,  -125,  -124,  -124,  -124,  -123,  -123,  -122,  -122,  -122,  -121,  -121,  -120,  -119,  -119,  -118,  -118,  -117,  -117,  -116,  -115,  -115,  -114,  -113,  -112,  -112,  -111,  -110,  -109,  -108,  -108,  -107,  -106,  -105,  -104,  -103,  -102,  -101,  -100,   -99,   -98,   -97,   -96,   -95,   -94,   -93,   -92,   -91,   -90,   -89,   -88,   -87,   -85,   -84,   -83,   -82,  
 -81,   -79,   -78,   -77,   -76,   -74,   -73,   -72,   -71,   -69,   -68,   -67,   -65,   -64,   -63,   -61,   -60,   -58,   -57,   -56,   -54,   -53,   -51,   -50,   -48,   -47,   -46,   -44,   -43,   -41,   -40,   -38,   -37,   -35,   -34,   -32,   -31,   -29,   -28,   -26,   -24,   -23,   -21,   -20,   -18,   -17,   -15,   -14,   -12,   -10,    -9,    -7,    -6,    -4,    -3,    -1};

/**4KHZ SIN*/
const unsigned short SinTab4k[SAMPLES] = {    0,     3,     6,     9,    12,    15,    18,    21,    24,    28,    31,    34,    37,    40,    43,    46,    48,    51,    54,    57,    60,    63,    65,    68,    71,   
 73,    76,    78,    81,    83,    85,    88,    90,    92,    94,    96,    98,   100,   102,   104,   106,   108,   109,   111,   112,   114,   115,   117,   118,   119,   120,   121,   122,   123,   124,   124,   125,   126,   126,   127,   127,   127,   127,   127,   128,   127,   127,   127,   127,   127,   126,   126,   125,   124,   124,   123,   122,   121,   120,   119,   118,   117,   115,   114,   112,   111,   109,   108, 106,   104,   102,   100,    98,    96,    94,    92,    90,    88,    85,    83,    81,    78,    76,    73,    71,    68,    65,    63,    60,    57,    54,    51,    48,    46,    43,    40,    37,    34,    31,    28,    24,    21,    18,    15,    12,     9,     6,     3,     0,    -3,    -6,    -9,   -12,   -15,   -18,   -21,   -24,   -28,   -31,   -34,   -37,   -40,   -43,   -46,   -48,   -51,   -54,   -57,   -60,   -63,   -65,  -68,   -71,   -73,   -76,   -78,   -81,   -83,   -85,   -88,   -90,   -92,   -94,   -96,   -98,  -100,  -102,  -104,  -106,  -108,  -109,  -111,  -112,  -114,  -115,  -117,  -118,  -119,  -120,  -121,  -122,  -123,  -124,
 -124,  -125,  -126,  -126,  -127,  -127,  -127,  -127,  -127,  -128,  -127,  -127,  -127,  -127,  -127,  -126,  -126,  -125,  -124,  -124,  -123,  -122,  -121,  -120,  -119,  -118,  -117,  -115,  -114,  -112,  -111,  -109,  -108,  -106,  -104,  -102,  -100,   -98,   -96,   -94,   -92,   -90,   -88,   -85,   -83,   -81,   -78,   -76,   -73,   -71,   -68,   -65,   -63,   -60,   -57,   -54,   -51,   -48,   -46,   -43,   -40,   -37,  -34,   -31,   -28,   -24,   -21,   -18,   -15,   -12,    -9,    -6,    -3,     0,     3,     6,     9,    12,    15,    18,    21,    24,    28,    31,    34,    37,    40,    43,    46,    48,    51,    54,    57,    60,    63,    65,    68,    71,    73,    76,    78,    81,    83,    85,    88,    90,    92,    94,    96,    98,   100,   102,   104,   106,   108,   109,   111,   112,   114,   115,   117,   118,   119,   120,   121, 122,   123,   124,   124,   125,   126,   126,   127,   127,   127,   127,   127,   128,   127,   127,   127,   127,   127,   126,   126,   125,   124,   124,   123,   122,   121,   120,   119,   118,   117,   115,   114,   112,
 111,   109,   108,   106,   104,   102,   100,    98,    96,    94,    92,    90,    88,    85,    83,    81,    78,    76,    73,    71,    68,    65,    63,    60,    57,    54,    51,    48,    46,    43, 40,    37,    34,    31,    28,    24,    21,    18,    15,    12,     9,     6,     3,     0,    -3,    -6,    -9,   -12,   -15,   -18,   -21,   -24,   -28,   -31,   -34,   -37,   -40,   -43,   -46,   -48,   -51,   -54,   -57,   -60,   -63,   -65,   -68,   -71,   -73,   -76,   -78,   -81,   -83,   -85,   -88,   -90,   -92,   -94,   -96,   -98,  -100,  -102,  -104,  -106,  -108,  -109,  -111,  -112,  -114,  -115,  -117,  -118,  -119,  -120,  -121,  -122,  -123,  -124,  -124,  -125,  -126,  -126,  -127,  -127,  -127,  -127,  -127,  -128,  -127,  -127,  -127,  -127,  -127,  -126,  -126,  -125,  -124,  -124,  -123,  -122,  -121,  -120,  -119,  -118,  -117,  -115,  -114,  -112,  -111,  -109,  -108,  -106,  -104,  -102,  -100,   -98,   -96,   -94,   -92,   -90,   -88,   -85,   -83,   -81,   -78,   -76,   -73,   -71,   -68,   -65,   -63,   -60,   -57,   -54,   -51,   -48,   -46,   -43,
    -40,   -37,   -34,   -31,   -28,   -24,   -21,   -18,   -15,   -12,    -9,    -6,    -3,     0,     3,     6,     9,    12,    15,    18,    21,    24,    28,    31,    34,    37,    40,    43,    46, 
  48,    51,    54,    57,    60,    63,    65,    68,    71,    73,    76,    78,    81,    83,    85,    88,    90,    92,    94,    96,    98,   100,   102,   104,   106,   108,   109,   111,   112,   114,   115,   117,   118,   119,   120,   121,   122,   123,   124,   124,   125,   126,   126,   127,   127,   127,   127,   127,   128,   127,   127,   127,   127,   127,   126,   126,   125,   124,   124,   123,   122,   121,   120,  119,   118,   117,   115,   114,   112,   111,   109,   108,   106,   104,   102,   100,    98,    96,    94,    92,    90,    88,    85,    83,    81,    78,    76,    73,    71,    68,    65,    63,    60,    57,  54,    51,    48,    46,    43,    40,    37,    34,    31,    28,    24,    21,    18,    15,    12,     9,     6,     3,     0,    -3,    -6,    -9,   -12,   -15,   -18,   -21,   -24,   -28,   -31,   -34,   -37,   -40,   -43,   -46,   -48,   -51,   -54,   -57,   -60,   -63,   -65,   -68,   -71,   -73,   -76,   -78,   -81,   -83,   -85,   -88,   -90,   -92,   -94,   -96,   -98,  -100,  -102,  -104,  -106,  -108,  -109,  -111,  -112,  -114,
   -115,  -117,  -118,  -119,  -120,  -121,  -122,  -123,  -124,  -124,  -125,  -126,  -126,  -127,  -127,  -127,  -127,  -127,  -128,  -127,  -127,  -127,  -127,  -127,  -126,  -126,  -125,  -124,  -124,  -123,  -122,  -121,  -120,  -119,  -118,  -117,  -115,  -114,  -112,  -111,  -109,  -108,  -106,  -104,  -102,  -100,   -98,   -96,   -94,   -92,   -90,   -88,   -85,   -83,   -81,   -78,   -76,   -73,   -71,   -68,   -65,   -63,  
 -60,   -57,   -54,   -51,   -48,   -46,   -43,   -40,   -37,   -34,   -31,   -28,   -24,   -21,   -18,   -15,   -12,    -9,    -6,    -3,     0,     3,     6,     9,    12,    15,    18,    21,    24,    28,    31,    34,    37,    40,    43,    46,    48,    51,    54,    57,    60,    63,    65,    68,    71,    73,    76,    78,    81,    83,    85,    88,    90,    92,    94,    96,    98,   100,   102,   104,   106,   108,   109,  111,   112,   114,   115,   117,   118,   119,   120,   121,   122,   123,   124,   124,   125,   126,   126,   127,   127,   127,   127,   127,   128,   127,   127,   127,   127,   127,   126,   126,   125,   124,   124,   123,   122,   121,   120,   119,   118,   117,   115,   114,   112,   111,   109,   108,   106,   104,   102,   100,    98,    96,    94,    92,    90,    88,    85,    83,    81,    78,    76,    73,    71,    68,    65,    63,    60,    57,    54,    51,    48,    46,    43,    40,    37,    34,    31,    28,    24,    21,    18,    15,    12,     9,     6,     3,     0,    -3,    -6,    -9,   -12,   -15,   -18,   -21,   -24,   
-28,   -31,   -34,   -37,   -40,   -43,   -46,   -48,   -51,   -54,   -57,   -60,   -63,   -65,   -68,   -71,   -73,   -76,   -78,   -81,   -83,   -85,   -88,   -90,   -92,   -94,   -96,   -98,  -100,  -102,  -104,  -106,  -108,  -109,  -111,  -112,  -114,  -115,  -117,  -118,  -119,  -120,  -121,  -122,  -123,  -124,  -124,  -125,  -126,  -126,  -127,  -127,  -127,  -127,  -127,  -128,  -127,  -127,  -127,  -127,  -127,  -126,  -126,  -125,  -124,  -124,  -123,  -122,  -121,  -120,  -119,  -118,  -117,  -115,  -114,  -112,  -111,  -109,  -108,  -106,  -104,  -102,  -100,   -98,   -96,   -94,   -92,   -90,   -88,   -85,   -83,   -81,   -78,   -76,   -73,   -71,   -68,   -65,   -63,   -60,   -57,   -54,   -51,   -48,   -46,   -43,   -40,   -37,   -34,   -31,   -28,   -24,   -21,   -18,   -15,   -12,    -9,    -6,    -3};

/**8KHZ SIN*/
const unsigned short SinTab8k[SAMPLES] = {    0,     6,    12,    18,    24,    31,    37,    43,    48,    54,    60,    65,    71,    76,    81,    85,    90,    94,    98,   102,   106,   109,   112,   115,   118,   
120,   122,   124,   125,   126,   127,   127,   128,   127,   127,   126,   125,   124,   122,   120,   118,   115,   112,   109,   106,   102,    98,    94,    90,    85,    81,    76,    71,    65,    60,    54,    48,    43,    37,    31,    24,    18,    12,     6,     0,    -6,   -12,   -18,   -24,   -31,   -37,   -43,   -48,   -54,   -60,   -65,   -71,   -76,   -81,   -85,   -90,   -94,   -98,  -102,  -106,  -109,  -112,  -115,  
-118,  -120,  -122,  -124,  -125,  -126,  -127,  -127,  -128,  -127,  -127,  -126,  -125,  -124,  -122,  -120,  -118,  -115,  -112,  -109,  -106,  -102,   -98,   -94,   -90,   -85,   -81,   -76,   -71,   -65,   -60,   -54,   -48,   -43,   -37,   -31,   -24,   -18,   -12,    -6,     0,     6,    12,    18,    24,    31,    37,    43,    48,    54,    60,    65,    71,    76,    81,    85,    90,    94,    98,   102,   106,   109,   112, 
  115,   118,   120,   122,   124,   125,   126,   127,   127,   128,   127,   127,   126,   125,   124,   122,   120,   118,   115,   112,   109,   106,   102,    98,    94,    90,    85,    81,    76,    71,    65,    
60,    54,    48,    43,    37,    31,    24,    18,    12,     6,     0,    -6,   -12,   -18,   -24,   -31,   -37,   -43,   -48,   -54,   -60,   -65,   -71,   -76,   -81,   -85,   -90,   -94,   -98,  -102,  -106,  -109,  -112,  -115,  -118,  -120,  -122,  -124,  -125,  -126,  -127,  -127,  -128,  -127,  -127,  -126,  -125,  -124,  -122,  -120,  -118,  -115,  -112,  -109,  -106,  -102,   -98,   -94,   -90,   -85,   -81,   -76,   -71,   
-65,   -60,   -54,   -48,   -43,   -37,   -31,   -24,   -18,   -12,    -6,     0,     6,    12,    18,    24,    31,    37,    43,    48,    54,    60,    65,    71,    76,    81,    85,    90,    94,    98,   102,   106,   109,   112,   115,   118,   120,   122,   124,   125,   126,   127,   127,   128,   127,   127,   126,   125,   124,   122,   120,   118,   115,   112,   109,   106,   102,    98,    94,    90,    85,    81,    76,  
  71,    65,    60,    54,    48,    43,    37,    31,    24,    18,    12,     6,     0,    -6,   -12,   -18,   -24,   -31,   -37,   -43,   -48,   -54,   -60,   -65,   -71,   -76,   -81,   -85,   -90,   -94,   -98,  -102,  -106,  -109,  -112,  -115,  -118,  -120,  -122,  -124,  -125,  -126,  -127,  -127,  -128,  -127,  -127,  -126,  -125,  -124,  -122,  -120,  -118,  -115,  -112,  -109,  -106,  -102,   -98,   -94,   -90,   -85,   -81, 
  -76,   -71,   -65,   -60,   -54,   -48,   -43,   -37,   -31,   -24,   -18,   -12,    -6,     0,     6,    12,    18,    24,    31,    37,    43,    48,    54,    60,    65,    71,    76,    81,    85,    90,    94,    
98,   102,   106,   109,   112,   115,   118,   120,   122,   124,   125,   126,   127,   127,   128,   127,   127,   126,   125,   124,   122,   120,   118,   115,   112,   109,   106,   102,    98,    94,    90,    85,    81,    76,    71,    65,    60,    54,    48,    43,    37,    31,    24,    18,    12,     6,     0,    -6,   -12,   -18,   -24,   -31,   -37,   -43,   -48,   -54,   -60,   -65,   -71,   -76,   -81,   -85,   -90,   
-94,   -98,  -102,  -106,  -109,  -112,  -115,  -118,  -120,  -122,  -124,  -125,  -126,  -127,  -127,  -128,  -127,  -127,  -126,  -125,  -124,  -122,  -120,  -118,  -115,  -112,  -109,  -106,  -102,   -98,   -94,   -90,   -85,   -81,   -76,   -71,   -65,   -60,   -54,   -48,   -43,   -37,   -31,   -24,   -18,   -12,    -6,     0,     6,    12,    18,    24,    31,    37,    43,    48,    54,    60,    65,    71,    76,    81,    85,  
  90,    94,    98,   102,   106,   109,   112,   115,   118,   120,   122,   124,   125,   126,   127,   127,   128,   127,   127,   126,   125,   124,   122,   120,   118,   115,   112,   109,   106,   102,    98,    94,    90,    85,    81,    76,    71,    65,    60,    54,    48,    43,    37,    31,    24,    18,    12,     6,     0,    -6,   -12,   -18,   -24,   -31,   -37,   -43,   -48,   -54,   -60,   -65,   -71,   -76,   -81, 
  -85,   -90,   -94,   -98,  -102,  -106,  -109,  -112,  -115,  -118,  -120,  -122,  -124,  -125,  -126,  -127,  -127,  -128,  -127,  -127,  -126,  -125,  -124,  -122,  -120,  -118,  -115,  -112,  -109,  -106,  -102,   -98,   -94,   -90,   -85,   -81,   -76,   -71,   -65,   -60,   -54,   -48,   -43,   -37,   -31,   -24,   -18,   -12,    -6,     0,     6,    12,    18,    24,    31,    37,    43,    48,    54,    60,    65,    71,    76,
      81,    85,    90,    94,    98,   102,   106,   109,   112,   115,   118,   120,   122,   124,   125,   126,   127,   127,   128,   127,   127,   126,   125,   124,   122,   120,   118,   115,   112,   109,   106,   
102,    98,    94,    90,    85,    81,    76,    71,    65,    60,    54,    48,    43,    37,    31,    24,    18,    12,     6,     0,    -6,   -12,   -18,   -24,   -31,   -37,   -43,   -48,   -54,   -60,   -65,   -71,   -76,   -81,   -85,   -90,   -94,   -98,  -102,  -106,  -109,  -112,  -115,  -118,  -120,  -122,  -124,  -125,  -126,  -127,  -127,  -128,  -127,  -127,  -126,  -125,  -124,  -122,  -120,  -118,  -115,  -112,  -109,  
-106,  -102,   -98,   -94,   -90,   -85,   -81,   -76,   -71,   -65,   -60,   -54,   -48,   -43,   -37,   -31,   -24,   -18,   -12,    -6,     0,     6,    12,    18,    24,    31,    37,    43,    48,    54,    60,    65,    71,    76,    81,    85,    90,    94,    98,   102,   106,   109,   112,   115,   118,   120,   122,   124,   125,   126,   127,   127,   128,   127,   127,   126,   125,   124,   122,   120,   118,   115,   112, 
  109,   106,   102,    98,    94,    90,    85,    81,    76,    71,    65,    60,    54,    48,    43,    37,    31,    24,    18,    12,     6,     0,    -6,   -12,   -18,   -24,   -31,   -37,   -43,   -48,   -54,   -60,   -65,   -71,   -76,   -81,   -85,   -90,   -94,   -98,  -102,  -106,  -109,  -112,  -115,  -118,  -120,  -122,  -124,  -125,  -126,  -127,  -127,  -128,  -127,  -127,  -126,  -125,  -124,  -122,  -120,  -118,  -115,
    -112,  -109,  -106,  -102,   -98,   -94,   -90,   -85,   -81,   -76,   -71,   -65,   -60,   -54,   -48,   -43,   -37,   -31,   -24,   -18,   -12,    -6,     0,     6,    12,    18,    24,    31,    37,    43,    48,   
 54,    60,    65,    71,    76,    81,    85,    90,    94,    98,   102,   106,   109,   112,   115,   118,   120,   122,   124,   125,   126,   127,   127,   128,   127,   127,   126,   125,   124,   122,   120,   118,   115,   112,   109,   106,   102,    98,    94,    90,    85,    81,    76,    71,    65,    60,    54,    48,    43,    37,    31,    24,    18,    12,     6,     0,    -6,   -12,   -18,   -24,   -31,   -37,   -43,  
 -48,   -54,   -60,   -65,   -71,   -76,   -81,   -85,   -90,   -94,   -98,  -102,  -106,  -109,  -112,  -115,  -118,  -120,  -122,  -124,  -125,  -126,  -127,  -127,  -128,  -127,  -127,  -126,  -125,  -124,  -122,  -120,  -118,  -115,  -112,  -109,  -106,  -102,   -98,   -94,   -90,   -85,   -81,   -76,   -71,   -65,   -60,   -54,   -48,   -43,   -37,   -31,   -24,   -18,   -12,    -6};





int main(void)
{
	// PCLK code
	int volatile *CR = 0x40021000;
	*CR |= (1 << 16);										// Enable HSE
	while (!(*CR & (1 << 17)));								// Wait for HSE is locked
	*CR &= ~(1 << 24);										// Disable PLL

	int volatile *CFGR = 0x40021000 + 0x04;
	*CFGR |= (0b0111 << 18);								// Set PLLMULL to 9. Set PLL output clock to 72 Mhz
	*CFGR |=  (1 << 16);									// Select HSE as the PLL source clock
	*CR |=  (1 << 24);										// Enable PLL
	while (!(*CR & (1 << 25)));								// Wait for PLL to lock

/*FLASH ACR*/
	int volatile *ACR = 0x40022000;							
	*ACR |= (0b010 << 0);									// Set FLASH WAIT STATE to 2
	*CFGR |= (0b0000 << 4);									// Set AHB HPRE division to 1. Set AHB clock to 72 Mhz
	*CFGR |= (0b100 << 8);									// Set APB1 PPRE1 division to 2. Set AHB clock to 36 Mhz
	*CFGR |= (0b10 << 0);									// Select PLL clock as the system clock
	while (!(*CFGR & (0b10 << 2)));							// Wait for PLL clock to be selected


/* DMA code*/
	int volatile *APB2ENR = 0x40021000 + 0x18;				// APB2 clock enable adress
	*APB2ENR |= (1<<4);										// Enable GPIOC clock (output)
	*APB2ENR |= (1<<3);										// Enable GPIOB clock (input for polling)
	int volatile *APB1ENR = 0x40021000 + 0x1C;				// APB1 clock enable adress
	*APB1ENR |= (1 << 0);									// Enable TIM2 clock
	int volatile *AHBENR = 0x40021000 + 0x14;				// Enable DMA1 clock
	*AHBENR |= (1 << 0);

	int volatile *ODR = 0x40011000 + 0x0c;					// ODR GPIOC

/*GPIOB (input)*/
	int volatile *crlb = 0x40010c00;						// Low Register
	*crlb = 0x88888888;										// Input -> MODE=00 & CNF=10 |1000|1000|1000|1000|
	int volatile *crhb = 0x40010c00 + 0x04;					// High Register
	*crhb = 0x88888888;										// Input -> MODE=00 & CNF=10 |1000|1000|1000|1000|
	int volatile *IDR = 0x40010c00 + 0x08;

/*GPIOC (output)*/
	int volatile *CRL = 0x40011000 + 0x00;
	*CRL = 0x33333333;										// Make low GPIOC output |0011|0011|0011|0011
	int volatile *CRH = 0x40011000 + 0x04;
	*CRH = 0x33333333;										// Make low GPIOC output |0011|0011|0011|0011

/*DMA*/
	int volatile *DMA_CNDTR = 0x40020000 + 0x20;			// offset = 0x0c + 0d20 * (2-1) channel 2
	*DMA_CNDTR = sizeof(data)/sizeof(uint32_t);				// transfer size
	int volatile *DMA_CMAR = 0x40020000 + 0x28;				// offset = 0x14 + 0d20 * (2-1) channel 2
	*DMA_CMAR = (uint32_t) data;							// Memory source address
	int volatile *DMA_CPAR = 0x40020000 + 0x24;				// offset = 0x10 + 0d20 * (2-1) channel 2
	*DMA_CPAR = (uint32_t) & *ODR;							// Peripheral destination address

	int volatile *DMA_CCR = 0x40020000 + 0x1c;				// offset = 0x08 + 0d20 * (2-1) channel 2
	*DMA_CCR = 0x00000000;									// Reset CCR --> set CCR's value to 0x00000000
	*DMA_CCR &= ~(1 << 14); 								// Disable memory to memory transfer on DMA1 channel 2 --> (MEM2MEM = 0)
	*DMA_CCR |= (0b11 << 12);								// Set DMA priority to very high --> (PL = 11)
	*DMA_CCR |= (0b10 << 10);								// Set memory transfer size to 32-bits -->(MSIZE = 10)
	*DMA_CCR |= (0b10 << 8);								// Set peripheral transfer size to 32-bits -->(PSIZE = 10)
	*DMA_CCR |= (1 << 7);									// Enable memory increment mode -->(MINC = 1)
	*DMA_CCR &= ~(1 << 6);									// Disable peripheral increment mode -->(PINC = 0)
	*DMA_CCR |=  (1 << 5);									// Enable circular mode -->(CIRC = 1)
	*DMA_CCR |=  (1 << 4);									// Read from memory -->(DIR = 1)
	*DMA_CCR |=  (1 << 2);									// Enable half transfer completed interrupt -->(HTIE = 1)
	*DMA_CCR |=  (1 << 1);									// Enable transfer completed interrupt -->(TCIE = 1)

	*DMA_CCR |=  (1 << 0);									// Enable DMA -->(EN = 1)


/*TIM2*/
	int volatile *TIM2_CR1 = 0x40000000 + 0x00;					// offset CR1 0x00
	*TIM2_CR1 = 0x0000;											// Reset CR1 just in case
	int volatile *TIM2_PSC = 0x40000000 + 0x28;					// offset PSC 0x28
	*TIM2_PSC = (72e3/8)/(sizeof(data)/sizeof(data[0]))-1;	// fCK_PSC / (PSC[15:0] + 1)  //-- (sizeof(data)/sizeof(data[0])) PODRIA REEMPLAZARSE POR SAMPLES
	int volatile *TIM2_ARR = 0x40000000 + 0x2c;					// offset ARR 0x2c
	*TIM2_ARR = 8-1;
	int volatile *TIM2_DIER = 0x40000000 + 0x0c;				// offset DIER 0x0c
	*TIM2_DIER |= (1 << 14);									// Trigger DMA request enable
	*TIM2_DIER |= (1 << 8);										// Update DMA request enable

	*TIM2_CR1 |= (1 << 0);									// Enable TIM1 module: Counter enable -->(CEN=1)


/**FUNCIONES SENOIDALES BASE**/
	int i = 0;
/*1kHz*//*
	int sin1khz[SAMPLES];
	for(i=0; i<SAMPLES; i++)
		sin1khz[i] = 128 * sin(2.0*PI*i*2/SAMPLES);//CAMBIO DE 127 A 128 LA AMPLITUD PARA QUE PUEDA SER REPRESENTADO CON 8 BITS (-128 A 127)
     */
/*2kHz*//*
	int sin2khz[SAMPLES];
	for(i=0; i<SAMPLES; i++)
		sin2khz[i] = 128 * sin(2.0*PI*i*2/SAMPLES);//CAMBIO DE 127 A 128 LA AMPLITUD PARA QUE PUEDA SER REPRESENTADO CON 8 BITS (-128 A 127)
		*/
/*4kHz*//*
	int sin4khz[SAMPLES];
	for(i=0; i<SAMPLES; i++)
		sin4khz[i] = 128 * sin(2.0*PI*i*4/SAMPLES);//CAMBIO DE 127 A 128 LA AMPLITUD PARA QUE PUEDA SER REPRESENTADO CON 8 BITS (-128 A 127)
		*/
/*8kHz*//*
	int sin8khz[SAMPLES];
	for(i=0; i<SAMPLES; i++)
		sin8khz[i] = 128 * sin(2.0*PI*i*8/SAMPLES);//CAMBIO DE 127 A 128 LA AMPLITUD PARA QUE PUEDA SER REPRESENTADO CON 8 BITS (-128 A 127)
		*/


	
	int sumatoria[SAMPLES];								// Vector para las combinaciones de todos los senos

	int volatile a = 0;									// Variables auxiliares para ayudar a realizar la suma
	int volatile b = 0;
	int volatile c = 0;
	int volatile d = 0;

	for(;;){

		int cont = 0;

		if(*IDR &= (1<<12)){
			a = 1;
			cont++;
		}
		else
			a = 0;

		if(*IDR &= (1<<13)){
			b = 1;
			cont++;
		}
		else
			b = 0;

		if(*IDR &= (1<<14)){
			c = 1;
			cont++;
		}
		else
			c = 0;

		if(*IDR &= (1<<15)){
			d = 1;
			cont++;
		}
		else
			d = 0;

		for(i=0; i<SAMPLES; i++)
			sumatoria[i] = a*SinTab1k[i] + b*SinTab2k[i] + c*SinTab4k[i] + d*SinTab8k[i];		// Suma de funciones seno
	
		sigma_delta(sumatoria, SAMPLES, cont);												// Conversión por Sigma Delta 

	};

	return 0;
}